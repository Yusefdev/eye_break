# EyeBreakWin — مدیریت کار و استراحت برای چشم‌ها و بدن

یک ابزار سبک برای ویندوز که چرخه‌های **کار / استراحت** را مدیریت می‌کند تا
در کنار همهٔ مشغله‌ها، کمی هم به **چشم‌ها** و **بدن**‌تان زمان بدهید.  
الهام‌گرفته از قانون 20-20-20 و الگوهای «اسنوز» (Snooze) برای مواقع ضروری.

> ایده: هر ۲۰ دقیقه کار، یک یادآور دوست‌داشتنی ظاهر می‌شود؛
> یک دقیقه فرصت دارید کار نیمه‌تمام‌تان را ببندید، سپس استراحت کوتاه شروع می‌شود.
> اگر واقعاً مجبورید ادامه بدهید، «پنالتی +۵ دقیقه» مثل Snooze عمل می‌کند و بعد دوباره یادآوری برمی‌گردد.

---

## قابلیت‌ها

- 🪟 **اورلیِ فول‌اسکرین با اسکرین‌شات + بلور نرم سه‌پاس** (Gaussian Approx.)
- 🔒 **قفل ورودی (کیبورد/ماوس)** در حین استراحت (خارج از پنجره بلاک می‌شود)
- ⏳ **وقفهٔ ۶۰ ثانیه‌ای (Grace)** قبل از قفل: می‌توانید روی همان صفحه دکمه‌ها را بزنید
- 🔕 **پنالتی / Snooze +۵ دقیقه**: صفحه بسته می‌شود، ۵ دقیقه فرصت کار، سپس یادآور برمی‌گردد
- 🔔 **سه صدای WAV** قابل تنظیم: نمایش یادآور، شروع قفل، پنالتی
- 🧰 **System Tray**: Start Now / Settings / Startup / Exit
- ⚙️ **صفحهٔ تنظیمات (GTK3)** + **ذخیره/لود تنظیمات** در کنار فایل اجرایی (`eye_break.ini`)
- 💤 **هوشمندی زمان کار**: اگر ۵ دقیقه یا بیشتر هیچ ورودی نداشتید، تایمر ۲۰ دقیقه جلو نمی‌رود
- 🖥️ پشتیبانی از **چند مانیتور** (Virtual Screen)

---

## اسکرین‌شات (شماتیک)
> در اورلی، شمارش‌معکوس، دکمهٔ «پنالتی +۵ دقیقه» و «خاموش کردن» نمایش داده می‌شود.
> پس‌زمینه همان اسکرین‌شات محیط شماست که به‌صورت نرم بلور شده است.

---

## دانلود و اجرا
- فایل اجرایی: `eye_break.exe`
- کنار آن سه فایل صدا قرار دهید (قابل تغییر از Settings):
  - `break_shown.wav` (هنگام نمایش یادآور)
  - `break_lock.wav`  (هنگام شروع قفل/استراحت)
  - `penalty.wav`     (هنگام پنالتی)

> از Tray می‌توانید برنامه را به **Startup** ویندوز اضافه کنید.

---

## ساخت (Build)

### گزینه ۱: MinGW-w64 / Clang + GTK3 (پیشنهادی برای توسعه‌دهنده‌ها)
به **MSYS2** یا محیطی نیاز دارید که GTK3 را با `pkg-config` فراهم کند.

1) نصب پیش‌نیازها (در MSYS2 MinGW x86_64):
```bash
pacman -S mingw-w64-x86_64-clang mingw-w64-x86_64-gtk3 mingw-w64-x86_64-pkg-config
```

2) بیلد:
```bash
clang -O2 -municode -mwindows eye_break_win.c -o eye_break.exe \
  -ldwmapi -luser32 -lgdi32 -lshell32 -lole32 -lwinmm \
  `pkg-config --cflags --libs gtk+-3.0`
```

### گزینه ۲: GCC (MinGW-w64) + GTK3
```bash
gcc -O2 -municode -mwindows eye_break_win.c -o eye_break.exe \
  -ldwmapi -luser32 -lgdi32 -lshell32 -lole32 -lwinmm \
  `pkg-config --cflags --libs gtk+-3.0`
```

### گزینه ۳: Visual Studio (MSVC)
- یک پروژهٔ Win32 (Windows Subsystem) بسازید.
- فایل `eye_break_win.c` را اضافه کنید.
- کتابخانه‌های زیر را لینک کنید:
  - `dwmapi.lib`, `user32.lib`, `gdi32.lib`, `shell32.lib`, `ole32.lib`, `winmm.lib`
- برای پنجرهٔ تنظیمات GTK3، یا **GTK Runtime** نصب و include/lib را به پروژه اضافه کنید یا بخش GTK را موقتاً غیرفعال کنید.

> نکته: اگر با `_wfopen(..., L"r, ccs=UTF-8")` مشکل داشتید، می‌توانید از نسخهٔ سادهٔ `_wfopen(path, L"r")` / `_wfopen(path, L"w")` استفاده کنید (فایل INI یونیکد را با UTF-8/ASCII ساده نگه دارید).

---

## استفاده
- پس از اجرا، آیکن برنامه در **System Tray** قرار می‌گیرد.
- منوی Tray:
  - **Start break now**: شروع فوری چرخه (Grace → Lock)
  - **Settings…**: بازکردن تنظیمات (GTK3)
  - **Add/Remove to Startup**: اضافه/حذف از اجرای خودکار ویندوز
  - **Exit**: خروج

### چرخهٔ کار
1. **Work**: شما مشغول کار هستید؛ اگر برای ≥۵ دقیقه بی‌حرکت باشید، تایمر نمی‌دود.
2. **Break Shown (Grace)**: یادآور ظاهر می‌شود (+صدای مخصوص)، ۶۰ ثانیه فرصت دارید.
3. **Break Active (Lock)**: قفل ورودی فعال می‌شود (+صدای مخصوص)، استراحت کوتاه شروع می‌شود.
4. **Penalty/Snooze**: اگر «پنالتی +۵ دقیقه» را بزنید، صفحه بسته می‌شود، ۵ دقیقه فرصت کار دارید (+صدای مخصوص)، سپس دوباره یادآور برمی‌گردد.

---

## تنظیمات و فایل INI
فایل `eye_break.ini` کنار exe ذخیره می‌شود. نمونهٔ محتوا:

```ini
work_interval_sec = 1200
break_default_sec = 20
penalty_sec       = 300
idle_pause_ms     = 300000
blur_radius       = 10
grace_sec         = 60
wav_break_shown   = break_shown.wav
wav_break_lock    = break_lock.wav
wav_penalty       = penalty.wav
```

> می‌توانید این مقادیر را از داخل **Settings…** هم ویرایش و ذخیره کنید.

---

## نکات فنی
- اورلی با WinAPI نوشته شده و برای بلور از الگوریتم **سه‌پاس BoxBlur** روی اسکرین‌شات استفاده می‌کند.
- قفل ورودی با **Low-Level Hooks** (کیبورد/ماوس) انجام می‌شود. داخل پنجرهٔ خود برنامه قابل کلیک است، بیرون از آن بلاک می‌شود.
- برای چند مانیتور از **Virtual Screen** استفاده می‌شود.

> هشدار: برخی آنتی‌ویروس‌ها ممکن است به‌دلیل استفاده از هوک‌های سراسری، برنامه‌های این‌چنینی را حساس بدانند. کد منبع باز است—می‌توانید بررسی و خودتان بیلد کنید.

---

## چرا این ابزار؟
نشستن طولانی‌مدت و خیره‌شدن به صفحه می‌تواند باعث خشکی چشم، خستگی و درد گردن/کمر شود.
این ابزار یادآوری می‌کند تا **وقفه‌های کوتاه اما مداوم** داشته باشید—کارایی‌تان معمولاً **بهتر** می‌شود، نه بدتر.  

---

## لایسنس
MIT — ازش استفاده کنید، تغییر بدهید، لذت ببرید؛ فقط کپی‌رایت و متن لایسنس را نگه دارید.

---

## سپاس
اگر ایده‌ای برای بهتر شدن UX (انیمیشن‌ها، تم روشن/تاریک، آیکن اختصاصی، پاور منو و …) دارید، PR بدید یا Issue بسازید. ❤️
